{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AccessLists = exports.checkMaxInitCodeSize = void 0;\nvar ethereumjs_util_1 = require(\"ethereumjs-util\");\nvar types_1 = require(\"./types\");\nfunction checkMaxInitCodeSize(common, length) {\n  if (length > common.param('vm', 'maxInitCodeSize')) {\n    throw new Error(\"the initcode size of this transaction is too large: it is \".concat(length, \" while the max is \").concat(common.param('vm', 'maxInitCodeSize')));\n  }\n}\nexports.checkMaxInitCodeSize = checkMaxInitCodeSize;\nvar AccessLists = /** @class */function () {\n  function AccessLists() {}\n  AccessLists.getAccessListData = function (accessList) {\n    var AccessListJSON;\n    var bufferAccessList;\n    if (accessList && (0, types_1.isAccessList)(accessList)) {\n      AccessListJSON = accessList;\n      var newAccessList = [];\n      for (var i = 0; i < accessList.length; i++) {\n        var item = accessList[i];\n        var addressBuffer = (0, ethereumjs_util_1.toBuffer)(item.address);\n        var storageItems = [];\n        for (var index = 0; index < item.storageKeys.length; index++) {\n          storageItems.push((0, ethereumjs_util_1.toBuffer)(item.storageKeys[index]));\n        }\n        newAccessList.push([addressBuffer, storageItems]);\n      }\n      bufferAccessList = newAccessList;\n    } else {\n      bufferAccessList = accessList !== null && accessList !== void 0 ? accessList : [];\n      // build the JSON\n      var json = [];\n      for (var i = 0; i < bufferAccessList.length; i++) {\n        var data = bufferAccessList[i];\n        var address = (0, ethereumjs_util_1.bufferToHex)(data[0]);\n        var storageKeys = [];\n        for (var item = 0; item < data[1].length; item++) {\n          storageKeys.push((0, ethereumjs_util_1.bufferToHex)(data[1][item]));\n        }\n        var jsonItem = {\n          address: address,\n          storageKeys: storageKeys\n        };\n        json.push(jsonItem);\n      }\n      AccessListJSON = json;\n    }\n    return {\n      AccessListJSON: AccessListJSON,\n      accessList: bufferAccessList\n    };\n  };\n  AccessLists.verifyAccessList = function (accessList) {\n    for (var key = 0; key < accessList.length; key++) {\n      var accessListItem = accessList[key];\n      var address = accessListItem[0];\n      var storageSlots = accessListItem[1];\n      if (accessListItem[2] !== undefined) {\n        throw new Error('Access list item cannot have 3 elements. It can only have an address, and an array of storage slots.');\n      }\n      if (address.length != 20) {\n        throw new Error('Invalid EIP-2930 transaction: address length should be 20 bytes');\n      }\n      for (var storageSlot = 0; storageSlot < storageSlots.length; storageSlot++) {\n        if (storageSlots[storageSlot].length != 32) {\n          throw new Error('Invalid EIP-2930 transaction: storage slot length should be 32 bytes');\n        }\n      }\n    }\n  };\n  AccessLists.getAccessListJSON = function (accessList) {\n    var accessListJSON = [];\n    for (var index = 0; index < accessList.length; index++) {\n      var item = accessList[index];\n      var JSONItem = {\n        address: '0x' + (0, ethereumjs_util_1.setLengthLeft)(item[0], 20).toString('hex'),\n        storageKeys: []\n      };\n      var storageSlots = item[1];\n      for (var slot = 0; slot < storageSlots.length; slot++) {\n        var storageSlot = storageSlots[slot];\n        JSONItem.storageKeys.push('0x' + (0, ethereumjs_util_1.setLengthLeft)(storageSlot, 32).toString('hex'));\n      }\n      accessListJSON.push(JSONItem);\n    }\n    return accessListJSON;\n  };\n  AccessLists.getDataFeeEIP2930 = function (accessList, common) {\n    var accessListStorageKeyCost = common.param('gasPrices', 'accessListStorageKeyCost');\n    var accessListAddressCost = common.param('gasPrices', 'accessListAddressCost');\n    var slots = 0;\n    for (var index = 0; index < accessList.length; index++) {\n      var item = accessList[index];\n      var storageSlots = item[1];\n      slots += storageSlots.length;\n    }\n    var addresses = accessList.length;\n    return addresses * accessListAddressCost + slots * accessListStorageKeyCost;\n  };\n  return AccessLists;\n}();\nexports.AccessLists = AccessLists;","map":{"version":3,"mappings":"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","names":["ethereumjs_util_1","require","types_1","checkMaxInitCodeSize","common","length","param","Error","concat","exports","AccessLists","getAccessListData","accessList","AccessListJSON","bufferAccessList","isAccessList","newAccessList","i","item","addressBuffer","toBuffer","address","storageItems","index","storageKeys","push","json","data","bufferToHex","jsonItem","verifyAccessList","key","accessListItem","storageSlots","undefined","storageSlot","getAccessListJSON","accessListJSON","JSONItem","setLengthLeft","toString","slot","getDataFeeEIP2930","accessListStorageKeyCost","accessListAddressCost","slots","addresses"],"ignoreList":[],"sourceRoot":"","sources":["../src/util.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}